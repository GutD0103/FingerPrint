#include "Image.h"
#include "Memory.h"
#include "newMath.h"
const UINT16 height = MaxHeight;
const UINT16 width = MaxWidth;

const float mask_gabor[MaskNumber][2 * WidthSquare + 1][2 * WidthSquare + 1] =
	{{
		 {-0.331447899341583, -0.412493616342545, -0.119106918573380, 0.366530716419220, 0.606530666351318, 0.366530716419220, -0.119106918573380, -0.412493616342545, -0.331447899341583},
		 {-0.412493586540222, -0.513356626033783, -0.148230955004692, 0.456154853105545, 0.754839599132538, 0.456154853105545, -0.148230955004692, -0.513356626033783, -0.412493586540222},
		 {-0.482253849506378, -0.600174665451050, -0.173299536108971, 0.533299088478088, 0.882496893405914, 0.533299088478088, -0.173299536108971, -0.600174665451050, -0.482253849506378},
		 {-0.529652237892151, -0.659162938594818, -0.190332308411598, 0.585714459419250, 0.969233214855194, 0.585714459419250, -0.190332308411598, -0.659162938594818, -0.529652237892151},
		 {-0.546465218067169, -0.680087029933929, -0.196374103426933, 0.604306995868683, 1.000000000000000, 0.604306995868683, -0.196374103426933, -0.680087029933929, -0.546465218067169},
		 {-0.529652237892151, -0.659162938594818, -0.190332308411598, 0.585714459419250, 0.969233214855194, 0.585714459419250, -0.190332308411598, -0.659162938594818, -0.529652237892151},
		 {-0.482253849506378, -0.600174665451050, -0.173299536108971, 0.533299088478088, 0.882496893405914, 0.533299088478088, -0.173299536108971, -0.600174665451050, -0.482253849506378},
		 {-0.412493586540222, -0.513356626033783, -0.148230955004692, 0.456154853105545, 0.754839599132538, 0.456154853105545, -0.148230955004692, -0.513356626033783, -0.412493586540222},
		 {-0.331447899341583, -0.412493616342545, -0.119106918573380, 0.366530716419220, 0.606530666351318, 0.366530716419220, -0.119106918573380, -0.412493616342545, -0.331447899341583},
	 },
	 {
		 {-0.260641425848007, -0.455074012279511, -0.287795752286911, 0.188046529889107, 0.569357991218567, 0.503810703754425, 0.072658702731133, -0.314451187849045, -0.366714864969254},
		 {-0.351508557796478, -0.558669924736023, -0.307431131601334, 0.294029504060745, 0.728699207305908, 0.591451704502106, 0.032085549086332, -0.426215529441834, -0.451420426368713},
		 {-0.439500272274017, -0.639121413230896, -0.297326087951660, 0.411245346069336, 0.868870198726654, 0.644565105438232, -0.030984343960881, -0.535214483737946, -0.517878413200378},
		 {-0.510313451290131, -0.681098937988281, -0.255822181701660, 0.522294104099274, 0.965484499931335, 0.650917470455170, -0.108994804322720, -0.623817622661591, -0.553521335124969},
		 {-0.550933063030243, -0.675783276557922, -0.188929498195648, 0.607576608657837, 1.000000000000000, 0.607576608657837, -0.188929498195648, -0.675783276557922, -0.550933063030243},
		 {-0.553521335124969, -0.623817622661591, -0.108994804322720, 0.650917470455170, 0.965484499931335, 0.522294104099274, -0.255822181701660, -0.681098937988281, -0.510313451290131},
		 {-0.517878413200378, -0.535214483737946, -0.030984343960881, 0.644565105438232, 0.868870198726654, 0.411245346069336, -0.297326087951660, -0.639121413230896, -0.439500272274017},
		 {-0.451420426368713, -0.426215529441834, 0.032085549086332, 0.591451704502106, 0.728699207305908, 0.294029504060745, -0.307431131601334, -0.558669924736023, -0.351508557796478},
		 {-0.366714864969254, -0.314451187849045, 0.072658702731133, 0.503810703754425, 0.569357991218567, 0.188046529889107, -0.287795752286911, -0.455074012279511, -0.260641425848007},
	 },
	 {
		 {-0.173307269811630, -0.448715358972549, -0.416056483983994, -0.005881647579372, 0.463724106550217, 0.578382372856140, 0.261557191610336, -0.165476575493813, -0.349130094051361},
		 {-0.282743602991104, -0.569607675075531, -0.436857819557190, 0.120247125625610, 0.653052866458893, 0.685993611812592, 0.219279706478119, -0.295345842838287, -0.452993899583817},
		 {-0.398850321769714, -0.658632159233093, -0.400496751070023, 0.285424113273621, 0.828925311565399, 0.737943768501282, 0.124323152005672, -0.439260274171829, -0.535027205944061},
		 {-0.499654471874237, -0.693216145038605, -0.305329263210297, 0.462965786457062, 0.954410672187805, 0.715322852134705, -0.012652380391955, -0.570878803730011, -0.575596392154694},
		 {-0.563306212425232, -0.662238478660584, -0.166585341095924, 0.617285966873169, 1.000000000000000, 0.617285966873169, -0.166585341095924, -0.662238478660584, -0.563306212425232},
		 {-0.575596392154694, -0.570878803730011, -0.012652380391955, 0.715322852134705, 0.954410672187805, 0.462965786457062, -0.305329263210297, -0.693216145038605, -0.499654471874237},
		 {-0.535027205944061, -0.439260274171829, 0.124323152005672, 0.737943768501282, 0.828925311565399, 0.285424113273621, -0.400496751070023, -0.658632159233093, -0.398850321769714},
		 {-0.452993899583817, -0.295345842838287, 0.219279706478119, 0.685993611812592, 0.653052866458893, 0.120247125625610, -0.436857819557190, -0.569607675075531, -0.282743602991104},
		 {-0.349130094051361, -0.165476575493813, 0.261557191610336, 0.578382372856140, 0.463724106550217, -0.005881647579372, -0.416056483983994, -0.448715358972549, -0.173307269811630},
	 },
	 {
		 {-0.085430033504963, -0.406626135110855, -0.496787637472153, -0.190710261464119, 0.305867910385132, 0.578022658824921, 0.417661547660828, 0.016564901918173, -0.269664853811264},
		 {-0.217453628778458, -0.556429088115692, -0.533506095409393, -0.051045812666416, 0.535734772682190, 0.729432582855225, 0.394914925098419, -0.126772195100784, -0.404503405094147},
		 {-0.366995722055435, -0.665509641170502, -0.482535153627396, 0.162153363227844, 0.765357077121735, 0.806997895240784, 0.284542173147202, -0.310519814491272, -0.521539449691772},
		 {-0.499705851078033, -0.698026895523071, -0.339110523462296, 0.409702897071838, 0.936517894268036, 0.776184737682343, 0.096839256584644, -0.496277064085007, -0.587537109851837},
		 {-0.580471038818359, -0.637630105018616, -0.129346802830696, 0.633136689662933, 1.000000000000000, 0.633136689662933, -0.129346802830696, -0.637630105018616, -0.580471038818359},
		 {-0.587537109851837, -0.496277064085007, 0.096839256584644, 0.776184737682343, 0.936517894268036, 0.409702897071838, -0.339110523462296, -0.698026895523071, -0.499705851078033},
		 {-0.521539449691772, -0.310519814491272, 0.284542173147202, 0.806997895240784, 0.765357077121735, 0.162153363227844, -0.482535153627396, -0.665509641170502, -0.366995722055435},
		 {-0.404503405094147, -0.126772195100784, 0.394914925098419, 0.729432582855225, 0.535734772682190, -0.051045812666416, -0.533506095409393, -0.556429088115692, -0.217453628778458},
		 {-0.269664853811264, 0.016564901918173, 0.417661547660828, 0.578022658824921, 0.305867910385132, -0.190710261464119, -0.496787637472153, -0.406626135110855, -0.085430033504963},
	 },
	 {
		 {-0.007841235958040, -0.344139099121094, -0.532081127166748, -0.347507566213608, 0.118603833019733, 0.502791404724121, 0.513735830783844, 0.202007398009300, -0.133822664618492},
		 {-0.163342908024788, -0.529829263687134, -0.599083304405212, -0.208480507135391, 0.388290077447891, 0.716854870319366, 0.539023876190186, 0.064512915909290, -0.300441920757294},
		 {-0.348214060068130, -0.665776193141937, -0.544794797897339, 0.046620767563581, 0.682308971881866, 0.846702218055725, 0.439257562160492, -0.151884406805038, -0.466755270957947},
		 {-0.510458648204803, -0.696679651737213, -0.357535630464554, 0.364117830991745, 0.912613630294800, 0.830734908580780, 0.216375634074211, -0.396971791982651, -0.579593241214752},
		 {-0.597214341163635, -0.599186480045319, -0.077338315546513, 0.654632270336151, 1.000000000000000, 0.654632270336151, -0.077338315546513, -0.599186480045319, -0.597214341163635},
		 {-0.579593241214752, -0.396971791982651, 0.216375634074211, 0.830734908580780, 0.912613630294800, 0.364117830991745, -0.357535630464554, -0.696679651737213, -0.510458648204803},
		 {-0.466755270957947, -0.151884406805038, 0.439257562160492, 0.846702218055725, 0.682308971881866, 0.046620767563581, -0.544794797897339, -0.665776193141937, -0.348214060068130},
		 {-0.300441920757294, 0.064512915909290, 0.539023876190186, 0.716854870319366, 0.388290077447891, -0.208480507135391, -0.599083304405212, -0.529829263687134, -0.163342908024788},
		 {-0.133822664618492, 0.202007398009300, 0.513735830783844, 0.502791404724121, 0.118603833019733, -0.347507566213608, -0.532081127166748, -0.344139099121094, -0.007841235958040},
	 },
	 {
		 {0.053720954805613, -0.275269925594330, -0.530453920364380, -0.465318173170090, -0.073634244501591, 0.365016520023346, 0.532068669795990, 0.355326026678085, 0.035574279725552},
		 {-0.125015646219254, -0.499315708875656, -0.638518750667572, -0.344439059495926, 0.224095672369003, 0.649693310260773, 0.633604407310486, 0.255675882101059, -0.146742120385170},
		 {-0.344700664281845, -0.664040207862854, -0.589534342288971, -0.057319715619087, 0.584915637969971, 0.854068875312805, 0.576707363128662, 0.028111906722188, -0.364618808031082},
		 {-0.529862284660339, -0.688842415809631, -0.360877871513367, 0.327465236186981, 0.883756875991821, 0.876353800296783, 0.341497302055359, -0.271990180015564, -0.541858077049255},
		 {-0.606343388557434, -0.543606817722321, -0.010964868590236, 0.681080400943756, 1.000000000000000, 0.681080400943756, -0.010964868590236, -0.543606817722321, -0.606343388557434},
		 {-0.541858077049255, -0.271990180015564, 0.341497302055359, 0.876353800296783, 0.883756875991821, 0.327465236186981, -0.360877871513367, -0.688842415809631, -0.529862284660339},
		 {-0.364618808031082, 0.028111906722188, 0.576707363128662, 0.854068875312805, 0.584915637969971, -0.057319715619087, -0.589534342288971, -0.664040207862854, -0.344700664281845},
		 {-0.146742120385170, 0.255675882101059, 0.633604407310486, 0.649693310260773, 0.224095672369003, -0.344439059495926, -0.638518750667572, -0.499315708875656, -0.125015646219254},
		 {0.035574279725552, 0.355326026678085, 0.532068669795990, 0.365016520023346, -0.073634244501591, -0.465318173170090, -0.530453920364380, -0.275269925594330, 0.053720954805613},
	 },
	 {
		 {0.097283609211445, -0.210888847708702, -0.503581345081329, -0.541337311267853, -0.249487444758415, 0.186266675591469, 0.469205439090729, 0.444243162870407, 0.201671212911606},
		 {-0.104844339191914, -0.472368925809860, -0.658371508121490, -0.455220103263855, 0.056379407644272, 0.535459220409393, 0.666139781475067, 0.419635295867920, 0.037286207079887},
		 {-0.356841892004013, -0.663156211376190, -0.619243144989014, -0.147142037749290, 0.478775829076767, 0.828535854816437, 0.685211718082428, 0.215340778231621, -0.216863602399826},
		 {-0.553747177124023, -0.672735512256622, -0.349192351102829, 0.300667971372604, 0.851195394992828, 0.910753428936005, 0.466475218534470, -0.123416773974895, -0.466219633817673},
		 {-0.599137902259827, -0.467667162418365, 0.068893022835255, 0.711600065231323, 1.000000000000000, 0.711600065231323, 0.068893022835255, -0.467667162418365, -0.599137902259827},
		 {-0.466219633817673, -0.123416773974895, 0.466475218534470, 0.910753428936005, 0.851195394992828, 0.300667971372604, -0.349192351102829, -0.672735512256622, -0.553747177124023},
		 {-0.216863602399826, 0.215340778231621, 0.685211718082428, 0.828535854816437, 0.478775829076767, -0.147142037749290, -0.619243144989014, -0.663156211376190, -0.356841892004013},
		 {0.037286207079887, 0.419635295867920, 0.666139781475067, 0.535459220409393, 0.056379407644272, -0.455220103263855, -0.658371508121490, -0.472368925809860, -0.104844339191914},
		 {0.201671212911606, 0.444243162870407, 0.469205439090729, 0.186266675591469, -0.249487444758415, -0.541337311267853, -0.503581345081329, -0.210888847708702, 0.097283609211445},
	 },
	 {
		 {0.122940249741077, -0.158327132463455, -0.463487207889557, -0.579393446445465, -0.393940448760986, -0.007684081792831, 0.336893677711487, 0.449052870273590, 0.323251128196716},
		 {-0.103790715336800, -0.454195678234100, -0.665451228618622, -0.540546536445618, -0.103459231555462, 0.386364370584488, 0.632204353809357, 0.530547976493835, 0.220972552895546},
		 {-0.383270680904388, -0.664075136184692, -0.636091530323029, -0.221476495265961, 0.369439572095871, 0.772041022777557, 0.754811763763428, 0.391430854797363, -0.035170212388039},
		 {-0.575769066810608, -0.645320177078247, -0.322293907403946, 0.284350812435150, 0.816296339035034, 0.932150900363922, 0.584612548351288, 0.042898163199425, -0.348798185586929},
		 {-0.566318333148956, -0.368997097015381, 0.160676077008247, 0.745134830474854, 1.000000000000000, 0.745134830474854, 0.160676077008247, -0.368997097015381, -0.566318333148956},
		 {-0.348798185586929, 0.042898163199425, 0.584612548351288, 0.932150900363922, 0.816296339035034, 0.284350812435150, -0.322293907403946, -0.645320177078247, -0.575769066810608},
		 {-0.035170212388039, 0.391430854797363, 0.754811763763428, 0.772041022777557, 0.369439572095871, -0.221476495265961, -0.636091530323029, -0.664075136184692, -0.383270680904388},
		 {0.220972552895546, 0.530547976493835, 0.632204353809357, 0.386364370584488, -0.103459231555462, -0.540546536445618, -0.665451228618622, -0.454195678234100, -0.103790715336800},
		 {0.323251128196716, 0.449052870273590, 0.336893677711487, -0.007684081792831, -0.393940448760986, -0.579393446445465, -0.463487207889557, -0.158327132463455, 0.122940249741077},
	 },
	 {
		 {0.131380170583725, -0.121900655329227, -0.420679628849030, -0.587570667266846, -0.499629676342011, -0.192327305674553, 0.158896908164024, 0.368670821189880, 0.367879450321198},
		 {-0.121900655329227, -0.447811126708984, -0.665804803371429, -0.602668404579163, -0.246953144669533, 0.217186391353607, 0.536412835121155, 0.569782853126526, 0.368670821189880},
		 {-0.420679628849030, -0.665804803371429, -0.641537189483643, -0.279834568500519, 0.261976718902588, 0.688767731189728, 0.778800785541534, 0.536412835121155, 0.158896908164024},
		 {-0.587570667266846, -0.602668404579163, -0.279834568500519, 0.278872758150101, 0.780476093292236, 0.939413070678711, 0.688767731189728, 0.217186391353607, -0.192327305674553},
		 {-0.499629676342011, -0.246953144669533, 0.261976718902588, 0.780476093292236, 1.000000000000000, 0.780476093292236, 0.261976718902588, -0.246953144669533, -0.499629676342011},
		 {-0.192327305674553, 0.217186391353607, 0.688767731189728, 0.939413070678711, 0.780476093292236, 0.278872758150101, -0.279834568500519, -0.602668404579163, -0.587570667266846},
		 {0.158896908164024, 0.536412835121155, 0.778800785541534, 0.688767731189728, 0.261976718902588, -0.279834568500519, -0.641537189483643, -0.665804803371429, -0.420679628849030},
		 {0.368670821189880, 0.569782853126526, 0.536412835121155, 0.217186391353607, -0.246953144669533, -0.602668404579163, -0.665804803371429, -0.447811126708984, -0.121900655329227},
		 {0.367879450321198, 0.368670821189880, 0.158896908164024, -0.192327305674553, -0.499629676342011, -0.587570667266846, -0.420679628849030, -0.121900655329227, 0.131380170583725},
	 },
	 {
		 {0.122940249741077, -0.103790923953056, -0.383270680904388, -0.575769126415253, -0.566318333148956, -0.348798125982285, -0.035170104354620, 0.220972642302513, 0.323251157999039},
		 {-0.158327132463455, -0.454195886850357, -0.664075195789337, -0.645320117473602, -0.368996977806091, 0.042898323386908, 0.391431003808975, 0.530548095703125, 0.449052900075912},
		 {-0.463487386703491, -0.665451288223267, -0.636091530323029, -0.322293907403946, 0.160676166415215, 0.584612607955933, 0.754811823368073, 0.632204413414001, 0.336893647909164},
		 {-0.579393446445465, -0.540546536445618, -0.221476331353188, 0.284350812435150, 0.745134890079498, 0.932150959968567, 0.772041022777557, 0.386364400386810, -0.007684082258493},
		 {-0.393940478563309, -0.103459239006042, 0.369439601898193, 0.816296339035034, 1.000000000000000, 0.816296339035034, 0.369439601898193, -0.103459239006042, -0.393940478563309},
		 {-0.007684082258493, 0.386364400386810, 0.772041022777557, 0.932150959968567, 0.745134890079498, 0.284350812435150, -0.221476331353188, -0.540546536445618, -0.579393446445465},
		 {0.336893647909164, 0.632204413414001, 0.754811823368073, 0.584612607955933, 0.160676166415215, -0.322293907403946, -0.636091530323029, -0.665451288223267, -0.463487386703491},
		 {0.449052900075912, 0.530548095703125, 0.391431003808975, 0.042898323386908, -0.368996977806091, -0.645320117473602, -0.664075195789337, -0.454195886850357, -0.158327132463455},
		 {0.323251157999039, 0.220972642302513, -0.035170104354620, -0.348798125982285, -0.566318333148956, -0.575769126415253, -0.383270680904388, -0.103790923953056, 0.122940249741077},
	 },
	 {
		 {0.097283609211445, -0.104844339191914, -0.356841892004013, -0.553747177124023, -0.599137902259827, -0.466219633817673, -0.216863602399826, 0.037286207079887, 0.201671212911606},
		 {-0.210888847708702, -0.472368925809860, -0.663156211376190, -0.672735512256622, -0.467667162418365, -0.123416773974895, 0.215340778231621, 0.419635295867920, 0.444243162870407},
		 {-0.503581345081329, -0.658371508121490, -0.619243144989014, -0.349192351102829, 0.068893022835255, 0.466475218534470, 0.685211718082428, 0.666139781475067, 0.469205439090729},
		 {-0.541337311267853, -0.455220103263855, -0.147142037749290, 0.300667971372604, 0.711600065231323, 0.910753428936005, 0.828535854816437, 0.535459220409393, 0.186266675591469},
		 {-0.249487444758415, 0.056379407644272, 0.478775829076767, 0.851195394992828, 1.000000000000000, 0.851195394992828, 0.478775829076767, 0.056379407644272, -0.249487444758415},
		 {0.186266675591469, 0.535459220409393, 0.828535854816437, 0.910753428936005, 0.711600065231323, 0.300667971372604, -0.147142037749290, -0.455220103263855, -0.541337311267853},
		 {0.469205439090729, 0.666139781475067, 0.685211718082428, 0.466475218534470, 0.068893022835255, -0.349192351102829, -0.619243144989014, -0.658371508121490, -0.503581345081329},
		 {0.444243162870407, 0.419635295867920, 0.215340778231621, -0.123416773974895, -0.467667162418365, -0.672735512256622, -0.663156211376190, -0.472368925809860, -0.210888847708702},
		 {0.201671212911606, 0.037286207079887, -0.216863602399826, -0.466219633817673, -0.599137902259827, -0.553747177124023, -0.356841892004013, -0.104844339191914, 0.097283609211445},
	 },
	 {
		 {0.053720958530903, -0.125015646219254, -0.344700664281845, -0.529862344264984, -0.606343388557434, -0.541858017444611, -0.364618629217148, -0.146742030978203, 0.035574439913034},
		 {-0.275269925594330, -0.499315917491913, -0.664040207862854, -0.688842415809631, -0.543606758117676, -0.271990031003952, 0.028112193569541, 0.255676090717316, 0.355326145887375},
		 {-0.530453920364380, -0.638518810272217, -0.589534401893616, -0.360877871513367, -0.010964774526656, 0.341497480869293, 0.576707482337952, 0.633604466915131, 0.532068669795990},
		 {-0.465318232774735, -0.344439059495926, -0.057319808751345, 0.327465236186981, 0.681080460548401, 0.876353859901428, 0.854068875312805, 0.649693310260773, 0.365016371011734},
		 {-0.073634371161461, 0.224095597863197, 0.584915518760681, 0.883756875991821, 1.000000000000000, 0.883756875991821, 0.584915518760681, 0.224095597863197, -0.073634371161461},
		 {0.365016371011734, 0.649693310260773, 0.854068875312805, 0.876353859901428, 0.681080460548401, 0.327465236186981, -0.057319808751345, -0.344439059495926, -0.465318232774735},
		 {0.532068669795990, 0.633604466915131, 0.576707482337952, 0.341497480869293, -0.010964774526656, -0.360877871513367, -0.589534401893616, -0.638518810272217, -0.530453920364380},
		 {0.355326145887375, 0.255676090717316, 0.028112193569541, -0.271990031003952, -0.543606758117676, -0.688842415809631, -0.664040207862854, -0.499315917491913, -0.275269925594330},
		 {0.035574439913034, -0.146742030978203, -0.364618629217148, -0.541858017444611, -0.606343388557434, -0.529862344264984, -0.344700664281845, -0.125015646219254, 0.053720958530903},
	 },
	 {
		 {-0.007841235958040, -0.163342908024788, -0.348214060068130, -0.510458648204803, -0.597214341163635, -0.579593241214752, -0.466755330562592, -0.300441920757294, -0.133822739124298},
		 {-0.344139099121094, -0.529829263687134, -0.665776193141937, -0.696679651737213, -0.599186480045319, -0.396971791982651, -0.151884540915489, 0.064512915909290, 0.202007353305817},
		 {-0.532081127166748, -0.599083244800568, -0.544794738292694, -0.357535630464554, -0.077338315546513, 0.216375544667244, 0.439257502555847, 0.539023876190186, 0.513735830783844},
		 {-0.347507566213608, -0.208480507135391, 0.046620767563581, 0.364117830991745, 0.654632270336151, 0.830734848976135, 0.846702218055725, 0.716854870319366, 0.502791464328766},
		 {0.118603900074959, 0.388290077447891, 0.682309031486511, 0.912613630294800, 1.000000000000000, 0.912613630294800, 0.682309031486511, 0.388290077447891, 0.118603900074959},
		 {0.502791464328766, 0.716854870319366, 0.846702218055725, 0.830734848976135, 0.654632270336151, 0.364117830991745, 0.046620767563581, -0.208480507135391, -0.347507566213608},
		 {0.513735830783844, 0.539023876190186, 0.439257502555847, 0.216375544667244, -0.077338315546513, -0.357535630464554, -0.544794738292694, -0.599083244800568, -0.532081127166748},
		 {0.202007353305817, 0.064512915909290, -0.151884540915489, -0.396971791982651, -0.599186480045319, -0.696679651737213, -0.665776193141937, -0.529829263687134, -0.344139099121094},
		 {-0.133822739124298, -0.300441920757294, -0.466755330562592, -0.579593241214752, -0.597214341163635, -0.510458648204803, -0.348214060068130, -0.163342908024788, -0.007841235958040},
	 },
	 {
		 {-0.085430026054382, -0.217453837394714, -0.366995722055435, -0.499706059694290, -0.580471038818359, -0.587537109851837, -0.521539449691772, -0.404503434896469, -0.269664883613586},
		 {-0.406626105308533, -0.556429088115692, -0.665509641170502, -0.698026895523071, -0.637630105018616, -0.496277064085007, -0.310519814491272, -0.126772254705429, 0.016564855352044},
		 {-0.496787637472153, -0.533506095409393, -0.482535153627396, -0.339110523462296, -0.129346802830696, 0.096839256584644, 0.284542083740234, 0.394914865493774, 0.417661488056183},
		 {-0.190710261464119, -0.051045812666416, 0.162153363227844, 0.409702897071838, 0.633136689662933, 0.776184678077698, 0.806997895240784, 0.729432582855225, 0.578022718429565},
		 {0.305867969989777, 0.535734832286835, 0.765357136726379, 0.936517894268036, 1.000000000000000, 0.936517894268036, 0.765357136726379, 0.535734832286835, 0.305867969989777},
		 {0.578022718429565, 0.729432582855225, 0.806997895240784, 0.776184678077698, 0.633136689662933, 0.409702897071838, 0.162153363227844, -0.051045812666416, -0.190710261464119},
		 {0.417661488056183, 0.394914865493774, 0.284542083740234, 0.096839256584644, -0.129346802830696, -0.339110523462296, -0.482535153627396, -0.533506095409393, -0.496787637472153},
		 {0.016564855352044, -0.126772254705429, -0.310519814491272, -0.496277064085007, -0.637630105018616, -0.698026895523071, -0.665509641170502, -0.556429088115692, -0.406626105308533},
		 {-0.269664883613586, -0.404503434896469, -0.521539449691772, -0.587537109851837, -0.580471038818359, -0.499706059694290, -0.366995722055435, -0.217453837394714, -0.085430026054382},
	 },
	 {
		 {-0.173307105898857, -0.282743602991104, -0.398850321769714, -0.499654471874237, -0.563306152820587, -0.575596392154694, -0.535027205944061, -0.452993899583817, -0.349130034446716},
		 {-0.448715358972549, -0.569607675075531, -0.658632218837738, -0.693216145038605, -0.662238478660584, -0.570878803730011, -0.439260274171829, -0.295345723628998, -0.165476486086845},
		 {-0.416056483983994, -0.436857819557190, -0.400496900081635, -0.305329263210297, -0.166585341095924, -0.012652380391955, 0.124323233962059, 0.219279780983925, 0.261557251214981},
		 {-0.005881710443646, 0.120247125625610, 0.285424113273621, 0.462965697050095, 0.617285966873169, 0.715322852134705, 0.737943768501282, 0.685993611812592, 0.578382432460785},
		 {0.463724046945572, 0.653052866458893, 0.828925311565399, 0.954410672187805, 1.000000000000000, 0.954410672187805, 0.828925311565399, 0.653052866458893, 0.463724046945572},
		 {0.578382432460785, 0.685993611812592, 0.737943768501282, 0.715322852134705, 0.617285966873169, 0.462965697050095, 0.285424113273621, 0.120247125625610, -0.005881710443646},
		 {0.261557251214981, 0.219279780983925, 0.124323233962059, -0.012652380391955, -0.166585341095924, -0.305329263210297, -0.400496900081635, -0.436857819557190, -0.416056483983994},
		 {-0.165476486086845, -0.295345723628998, -0.439260274171829, -0.570878803730011, -0.662238478660584, -0.693216145038605, -0.658632218837738, -0.569607675075531, -0.448715358972549},
		 {-0.349130034446716, -0.452993899583817, -0.535027205944061, -0.575596392154694, -0.563306152820587, -0.499654471874237, -0.398850321769714, -0.282743602991104, -0.173307105898857},
	 },
	 {
		 {-0.260641425848007, -0.351508557796478, -0.439500272274017, -0.510313451290131, -0.550933063030243, -0.553521335124969, -0.517878413200378, -0.451420426368713, -0.366714864969254},
		 {-0.455074012279511, -0.558669924736023, -0.639121413230896, -0.681098937988281, -0.675783276557922, -0.623817622661591, -0.535214483737946, -0.426215529441834, -0.314451187849045},
		 {-0.287795752286911, -0.307431131601334, -0.297326087951660, -0.255822181701660, -0.188929498195648, -0.108994804322720, -0.030984343960881, 0.032085549086332, 0.072658702731133},
		 {0.188046529889107, 0.294029504060745, 0.411245346069336, 0.522294104099274, 0.607576608657837, 0.650917470455170, 0.644565105438232, 0.591451704502106, 0.503810703754425},
		 {0.569357991218567, 0.728699207305908, 0.868870198726654, 0.965484499931335, 1.000000000000000, 0.965484499931335, 0.868870198726654, 0.728699207305908, 0.569357991218567},
		 {0.503810703754425, 0.591451704502106, 0.644565105438232, 0.650917470455170, 0.607576608657837, 0.522294104099274, 0.411245346069336, 0.294029504060745, 0.188046529889107},
		 {0.072658702731133, 0.032085549086332, -0.030984343960881, -0.108994804322720, -0.188929498195648, -0.255822181701660, -0.297326087951660, -0.307431131601334, -0.287795752286911},
		 {-0.314451187849045, -0.426215529441834, -0.535214483737946, -0.623817622661591, -0.675783276557922, -0.681098937988281, -0.639121413230896, -0.558669924736023, -0.455074012279511},
		 {-0.366714864969254, -0.451420426368713, -0.517878413200378, -0.553521335124969, -0.550933063030243, -0.510313451290131, -0.439500272274017, -0.351508557796478, -0.260641425848007},
	 },
	 {
		 {-0.331447958946228, -0.412493616342545, -0.482253819704056, -0.529652237892151, -0.546465218067169, -0.529652237892151, -0.482253849506378, -0.412493586540222, -0.331447929143906},
		 {-0.412493616342545, -0.513356566429138, -0.600174665451050, -0.659162938594818, -0.680087029933929, -0.659162938594818, -0.600174725055695, -0.513356685638428, -0.412493675947189},
		 {-0.119106858968735, -0.148230880498886, -0.173299461603165, -0.190332308411598, -0.196374103426933, -0.190332308411598, -0.173299536108971, -0.148231089115143, -0.119107022881508},
		 {0.366530805826187, 0.456154912710190, 0.533299088478088, 0.585714459419250, 0.604306995868683, 0.585714459419250, 0.533298969268799, 0.456154793500900, 0.366530686616898},
		 {0.606530666351318, 0.754839599132538, 0.882496893405914, 0.969233214855194, 1.000000000000000, 0.969233214855194, 0.882496893405914, 0.754839599132538, 0.606530666351318},
		 {0.366530686616898, 0.456154793500900, 0.533298969268799, 0.585714459419250, 0.604306995868683, 0.585714459419250, 0.533299088478088, 0.456154912710190, 0.366530805826187},
		 {-0.119107022881508, -0.148231089115143, -0.173299536108971, -0.190332308411598, -0.196374103426933, -0.190332308411598, -0.173299461603165, -0.148230880498886, -0.119106858968735},
		 {-0.412493675947189, -0.513356685638428, -0.600174725055695, -0.659162938594818, -0.680087029933929, -0.659162938594818, -0.600174665451050, -0.513356566429138, -0.412493616342545},
		 {-0.331447929143906, -0.412493586540222, -0.482253849506378, -0.529652237892151, -0.546465218067169, -0.529652237892151, -0.482253819704056, -0.412493616342545, -0.331447958946228},
	 },
	 {
		 {-0.366714835166931, -0.451420456171036, -0.517878413200378, -0.553521335124969, -0.550933063030243, -0.510313451290131, -0.439500272274017, -0.351508527994156, -0.260641425848007},
		 {-0.314451247453690, -0.426215529441834, -0.535214543342590, -0.623817622661591, -0.675783276557922, -0.681098937988281, -0.639121413230896, -0.558669924736023, -0.455074042081833},
		 {0.072658643126488, 0.032085474580526, -0.030984427779913, -0.108994804322720, -0.188929498195648, -0.255822181701660, -0.297326087951660, -0.307431042194366, -0.287795752286911},
		 {0.503810644149780, 0.591451644897461, 0.644565045833588, 0.650917410850525, 0.607576608657837, 0.522294104099274, 0.411245346069336, 0.294029504060745, 0.188046589493752},
		 {0.569358050823212, 0.728699207305908, 0.868870258331299, 0.965484499931335, 1.000000000000000, 0.965484499931335, 0.868870258331299, 0.728699207305908, 0.569358050823212},
		 {0.188046589493752, 0.294029504060745, 0.411245346069336, 0.522294104099274, 0.607576608657837, 0.650917410850525, 0.644565045833588, 0.591451644897461, 0.503810644149780},
		 {-0.287795752286911, -0.307431042194366, -0.297326087951660, -0.255822181701660, -0.188929498195648, -0.108994804322720, -0.030984427779913, 0.032085474580526, 0.072658643126488},
		 {-0.455074042081833, -0.558669924736023, -0.639121413230896, -0.681098937988281, -0.675783276557922, -0.623817622661591, -0.535214543342590, -0.426215529441834, -0.314451247453690},
		 {-0.260641425848007, -0.351508527994156, -0.439500272274017, -0.510313451290131, -0.550933063030243, -0.553521335124969, -0.517878413200378, -0.451420456171036, -0.366714835166931},
	 },
	 {
		 {-0.349130094051361, -0.452993899583817, -0.535027205944061, -0.575596392154694, -0.563306212425232, -0.499654471874237, -0.398850321769714, -0.282743602991104, -0.173307269811630},
		 {-0.165476575493813, -0.295345842838287, -0.439260274171829, -0.570878803730011, -0.662238478660584, -0.693216145038605, -0.658632159233093, -0.569607675075531, -0.448715358972549},
		 {0.261557191610336, 0.219279706478119, 0.124323152005672, -0.012652380391955, -0.166585341095924, -0.305329263210297, -0.400496751070023, -0.436857819557190, -0.416056483983994},
		 {0.578382372856140, 0.685993611812592, 0.737943768501282, 0.715322852134705, 0.617285966873169, 0.462965786457062, 0.285424113273621, 0.120247125625610, -0.005881647579372},
		 {0.463724106550217, 0.653052866458893, 0.828925311565399, 0.954410672187805, 1.000000000000000, 0.954410672187805, 0.828925311565399, 0.653052866458893, 0.463724106550217},
		 {-0.005881647579372, 0.120247125625610, 0.285424113273621, 0.462965786457062, 0.617285966873169, 0.715322852134705, 0.737943768501282, 0.685993611812592, 0.578382372856140},
		 {-0.416056483983994, -0.436857819557190, -0.400496751070023, -0.305329263210297, -0.166585341095924, -0.012652380391955, 0.124323152005672, 0.219279706478119, 0.261557191610336},
		 {-0.448715358972549, -0.569607675075531, -0.658632159233093, -0.693216145038605, -0.662238478660584, -0.570878803730011, -0.439260274171829, -0.295345842838287, -0.165476575493813},
		 {-0.173307269811630, -0.282743602991104, -0.398850321769714, -0.499654471874237, -0.563306212425232, -0.575596392154694, -0.535027205944061, -0.452993899583817, -0.349130094051361},
	 },
	 {
		 {-0.269664764404297, -0.404503315687180, -0.521539449691772, -0.587537109851837, -0.580471098423004, -0.499706059694290, -0.366995960474014, -0.217453837394714, -0.085430033504963},
		 {0.016565002501011, -0.126772120594978, -0.310519695281982, -0.496277034282684, -0.637630105018616, -0.698026895523071, -0.665509641170502, -0.556429028511047, -0.406626015901566},
		 {0.417661696672440, 0.394915014505386, 0.284542322158813, 0.096839442849159, -0.129346713423729, -0.339110374450684, -0.482535153627396, -0.533506095409393, -0.496787667274475},
		 {0.578022718429565, 0.729432582855225, 0.806998014450073, 0.776184797286987, 0.633136689662933, 0.409702897071838, 0.162153378129005, -0.051045890897512, -0.190710395574570},
		 {0.305867820978165, 0.535734713077545, 0.765357077121735, 0.936517834663391, 1.000000000000000, 0.936517834663391, 0.765357077121735, 0.535734713077545, 0.305867820978165},
		 {-0.190710395574570, -0.051045890897512, 0.162153378129005, 0.409702897071838, 0.633136689662933, 0.776184797286987, 0.806998014450073, 0.729432582855225, 0.578022718429565},
		 {-0.496787667274475, -0.533506095409393, -0.482535153627396, -0.339110374450684, -0.129346713423729, 0.096839442849159, 0.284542322158813, 0.394915014505386, 0.417661696672440},
		 {-0.406626015901566, -0.556429028511047, -0.665509641170502, -0.698026895523071, -0.637630105018616, -0.496277034282684, -0.310519695281982, -0.126772120594978, 0.016565002501011},
		 {-0.085430033504963, -0.217453837394714, -0.366995960474014, -0.499706059694290, -0.580471098423004, -0.587537109851837, -0.521539449691772, -0.404503315687180, -0.269664764404297},
	 },
	 {
		 {-0.133822798728943, -0.300442039966583, -0.466755360364914, -0.579593241214752, -0.597214281558990, -0.510458469390869, -0.348214060068130, -0.163342908024788, -0.007841235958040},
		 {0.202007219195366, 0.064512729644775, -0.151884675025940, -0.396971940994263, -0.599186599254608, -0.696679711341858, -0.665776133537292, -0.529829263687134, -0.344139099121094},
		 {0.513735830783844, 0.539023756980896, 0.439257413148880, 0.216375455260277, -0.077338404953480, -0.357535630464554, -0.544794738292694, -0.599083244800568, -0.532081067562103},
		 {0.502791464328766, 0.716854870319366, 0.846702218055725, 0.830734848976135, 0.654632270336151, 0.364117830991745, 0.046620767563581, -0.208480358123779, -0.347507566213608},
		 {0.118603952229023, 0.388290137052536, 0.682309031486511, 0.912613630294800, 1.000000000000000, 0.912613630294800, 0.682309031486511, 0.388290137052536, 0.118603952229023},
		 {-0.347507566213608, -0.208480358123779, 0.046620767563581, 0.364117830991745, 0.654632270336151, 0.830734848976135, 0.846702218055725, 0.716854870319366, 0.502791464328766},
		 {-0.532081067562103, -0.599083244800568, -0.544794738292694, -0.357535630464554, -0.077338404953480, 0.216375455260277, 0.439257413148880, 0.539023756980896, 0.513735830783844},
		 {-0.344139099121094, -0.529829263687134, -0.665776133537292, -0.696679711341858, -0.599186599254608, -0.396971940994263, -0.151884675025940, 0.064512729644775, 0.202007219195366},
		 {-0.007841235958040, -0.163342908024788, -0.348214060068130, -0.510458469390869, -0.597214281558990, -0.579593241214752, -0.466755360364914, -0.300442039966583, -0.133822798728943},
	 },
	 {
		 {0.035574160516262, -0.146742314100266, -0.364618808031082, -0.541858077049255, -0.606343388557434, -0.529862284660339, -0.344700664281845, -0.125015854835510, 0.053720954805613},
		 {0.355325967073441, 0.255675733089447, 0.028111837804317, -0.271990180015564, -0.543606877326965, -0.688842415809631, -0.664040207862854, -0.499315887689590, -0.275270104408264},
		 {0.532068729400635, 0.633604347705841, 0.576707243919373, 0.341497302055359, -0.010964868590236, -0.360877871513367, -0.589534342288971, -0.638518750667572, -0.530453979969025},
		 {0.365016669034958, 0.649693429470062, 0.854068875312805, 0.876353740692139, 0.681080400943756, 0.327465236186981, -0.057319626212120, -0.344438791275024, -0.465318113565445},
		 {-0.073634050786495, 0.224095910787582, 0.584915697574615, 0.883756935596466, 1.000000000000000, 0.883756935596466, 0.584915697574615, 0.224095910787582, -0.073634050786495},
		 {-0.465318113565445, -0.344438791275024, -0.057319626212120, 0.327465236186981, 0.681080400943756, 0.876353740692139, 0.854068875312805, 0.649693429470062, 0.365016669034958},
		 {-0.530453979969025, -0.638518750667572, -0.589534342288971, -0.360877871513367, -0.010964868590236, 0.341497302055359, 0.576707243919373, 0.633604347705841, 0.532068729400635},
		 {-0.275270104408264, -0.499315887689590, -0.664040207862854, -0.688842415809631, -0.543606877326965, -0.271990180015564, 0.028111837804317, 0.255675733089447, 0.355325967073441},
		 {0.053720954805613, -0.125015854835510, -0.344700664281845, -0.529862284660339, -0.606343388557434, -0.541858077049255, -0.364618808031082, -0.146742314100266, 0.035574160516262},
	 },
	 {
		 {0.201671078801155, 0.037286058068275, -0.216863796114922, -0.466219753026962, -0.599137902259827, -0.553747177124023, -0.356841892004013, -0.104844339191914, 0.097283609211445},
		 {0.444243103265762, 0.419635176658630, 0.215340569615364, -0.123416997492313, -0.467667281627655, -0.672735571861267, -0.663156211376190, -0.472368925809860, -0.210888847708702},
		 {0.469205528497696, 0.666139781475067, 0.685211658477783, 0.466475039720535, 0.068892925977707, -0.349192351102829, -0.619243144989014, -0.658371448516846, -0.503581345081329},
		 {0.186266869306564, 0.535459339618683, 0.828535914421082, 0.910753369331360, 0.711600005626678, 0.300667971372604, -0.147142037749290, -0.455220073461533, -0.541337251663208},
		 {-0.249487325549126, 0.056379489600658, 0.478775888681412, 0.851195454597473, 1.000000000000000, 0.851195454597473, 0.478775888681412, 0.056379489600658, -0.249487325549126},
		 {-0.541337251663208, -0.455220073461533, -0.147142037749290, 0.300667971372604, 0.711600005626678, 0.910753369331360, 0.828535914421082, 0.535459339618683, 0.186266869306564},
		 {-0.503581345081329, -0.658371448516846, -0.619243144989014, -0.349192351102829, 0.068892925977707, 0.466475039720535, 0.685211658477783, 0.666139781475067, 0.469205528497696},
		 {-0.210888847708702, -0.472368925809860, -0.663156211376190, -0.672735571861267, -0.467667281627655, -0.123416997492313, 0.215340569615364, 0.419635176658630, 0.444243103265762},
		 {0.097283609211445, -0.104844339191914, -0.356841892004013, -0.553747177124023, -0.599137902259827, -0.466219753026962, -0.216863796114922, 0.037286058068275, 0.201671078801155},
	 },
	 {
		 {0.323251128196716, 0.220972552895546, -0.035170212388039, -0.348798185586929, -0.566318333148956, -0.575769066810608, -0.383270680904388, -0.103790715336800, 0.122940249741077},
		 {0.449052870273590, 0.530547976493835, 0.391430854797363, 0.042898163199425, -0.368997097015381, -0.645320177078247, -0.664075136184692, -0.454195678234100, -0.158327132463455},
		 {0.336893677711487, 0.632204353809357, 0.754811763763428, 0.584612548351288, 0.160676077008247, -0.322293907403946, -0.636091530323029, -0.665451228618622, -0.463487207889557},
		 {-0.007684081792831, 0.386364370584488, 0.772041022777557, 0.932150900363922, 0.745134830474854, 0.284350812435150, -0.221476495265961, -0.540546536445618, -0.579393446445465},
		 {-0.393940448760986, -0.103459231555462, 0.369439572095871, 0.816296339035034, 1.000000000000000, 0.816296339035034, 0.369439572095871, -0.103459231555462, -0.393940448760986},
		 {-0.579393446445465, -0.540546536445618, -0.221476495265961, 0.284350812435150, 0.745134830474854, 0.932150900363922, 0.772041022777557, 0.386364370584488, -0.007684081792831},
		 {-0.463487207889557, -0.665451228618622, -0.636091530323029, -0.322293907403946, 0.160676077008247, 0.584612548351288, 0.754811763763428, 0.632204353809357, 0.336893677711487},
		 {-0.158327132463455, -0.454195678234100, -0.664075136184692, -0.645320177078247, -0.368997097015381, 0.042898163199425, 0.391430854797363, 0.530547976493835, 0.449052870273590},
		 {0.122940249741077, -0.103790715336800, -0.383270680904388, -0.575769066810608, -0.566318333148956, -0.348798185586929, -0.035170212388039, 0.220972552895546, 0.323251128196716},
	 },
	 {
		 {0.367879450321198, 0.368670821189880, 0.158896908164024, -0.192327305674553, -0.499629676342011, -0.587570667266846, -0.420679628849030, -0.121900655329227, 0.131380170583725},
		 {0.368670821189880, 0.569782853126526, 0.536412835121155, 0.217186391353607, -0.246953144669533, -0.602668404579163, -0.665804803371429, -0.447811126708984, -0.121900655329227},
		 {0.158896908164024, 0.536412835121155, 0.778800785541534, 0.688767731189728, 0.261976718902588, -0.279834568500519, -0.641537189483643, -0.665804803371429, -0.420679628849030},
		 {-0.192327305674553, 0.217186391353607, 0.688767731189728, 0.939413070678711, 0.780476093292236, 0.278872758150101, -0.279834568500519, -0.602668404579163, -0.587570667266846},
		 {-0.499629676342011, -0.246953144669533, 0.261976718902588, 0.780476093292236, 1.000000000000000, 0.780476093292236, 0.261976718902588, -0.246953144669533, -0.499629676342011},
		 {-0.587570667266846, -0.602668404579163, -0.279834568500519, 0.278872758150101, 0.780476093292236, 0.939413070678711, 0.688767731189728, 0.217186391353607, -0.192327305674553},
		 {-0.420679628849030, -0.665804803371429, -0.641537189483643, -0.279834568500519, 0.261976718902588, 0.688767731189728, 0.778800785541534, 0.536412835121155, 0.158896908164024},
		 {-0.121900655329227, -0.447811126708984, -0.665804803371429, -0.602668404579163, -0.246953144669533, 0.217186391353607, 0.536412835121155, 0.569782853126526, 0.368670821189880},
		 {0.131380170583725, -0.121900655329227, -0.420679628849030, -0.587570667266846, -0.499629676342011, -0.192327305674553, 0.158896908164024, 0.368670821189880, 0.367879450321198},
	 },
	 {
		 {0.323251128196716, 0.449052870273590, 0.336893677711487, -0.007684081792831, -0.393940448760986, -0.579393446445465, -0.463487207889557, -0.158327132463455, 0.122940249741077},
		 {0.220972552895546, 0.530547976493835, 0.632204353809357, 0.386364370584488, -0.103459231555462, -0.540546536445618, -0.665451228618622, -0.454195678234100, -0.103790715336800},
		 {-0.035170212388039, 0.391430854797363, 0.754811763763428, 0.772041022777557, 0.369439572095871, -0.221476495265961, -0.636091530323029, -0.664075136184692, -0.383270680904388},
		 {-0.348798185586929, 0.042898163199425, 0.584612548351288, 0.932150900363922, 0.816296339035034, 0.284350812435150, -0.322293907403946, -0.645320177078247, -0.575769066810608},
		 {-0.566318333148956, -0.368997097015381, 0.160676077008247, 0.745134830474854, 1.000000000000000, 0.745134830474854, 0.160676077008247, -0.368997097015381, -0.566318333148956},
		 {-0.575769066810608, -0.645320177078247, -0.322293907403946, 0.284350812435150, 0.816296339035034, 0.932150900363922, 0.584612548351288, 0.042898163199425, -0.348798185586929},
		 {-0.383270680904388, -0.664075136184692, -0.636091530323029, -0.221476495265961, 0.369439572095871, 0.772041022777557, 0.754811763763428, 0.391430854797363, -0.035170212388039},
		 {-0.103790715336800, -0.454195678234100, -0.665451228618622, -0.540546536445618, -0.103459231555462, 0.386364370584488, 0.632204353809357, 0.530547976493835, 0.220972552895546},
		 {0.122940249741077, -0.158327132463455, -0.463487207889557, -0.579393446445465, -0.393940448760986, -0.007684081792831, 0.336893677711487, 0.449052870273590, 0.323251128196716},
	 },
	 {
		 {0.201671078801155, 0.444243103265762, 0.469205528497696, 0.186266869306564, -0.249487325549126, -0.541337251663208, -0.503581345081329, -0.210888847708702, 0.097283609211445},
		 {0.037286058068275, 0.419635176658630, 0.666139781475067, 0.535459339618683, 0.056379489600658, -0.455220073461533, -0.658371448516846, -0.472368925809860, -0.104844339191914},
		 {-0.216863796114922, 0.215340569615364, 0.685211658477783, 0.828535914421082, 0.478775888681412, -0.147142037749290, -0.619243144989014, -0.663156211376190, -0.356841892004013},
		 {-0.466219753026962, -0.123416997492313, 0.466475039720535, 0.910753369331360, 0.851195454597473, 0.300667971372604, -0.349192351102829, -0.672735571861267, -0.553747177124023},
		 {-0.599137902259827, -0.467667281627655, 0.068892925977707, 0.711600005626678, 1.000000000000000, 0.711600005626678, 0.068892925977707, -0.467667281627655, -0.599137902259827},
		 {-0.553747177124023, -0.672735571861267, -0.349192351102829, 0.300667971372604, 0.851195454597473, 0.910753369331360, 0.466475039720535, -0.123416997492313, -0.466219753026962},
		 {-0.356841892004013, -0.663156211376190, -0.619243144989014, -0.147142037749290, 0.478775888681412, 0.828535914421082, 0.685211658477783, 0.215340569615364, -0.216863796114922},
		 {-0.104844339191914, -0.472368925809860, -0.658371448516846, -0.455220073461533, 0.056379489600658, 0.535459339618683, 0.666139781475067, 0.419635176658630, 0.037286058068275},
		 {0.097283609211445, -0.210888847708702, -0.503581345081329, -0.541337251663208, -0.249487325549126, 0.186266869306564, 0.469205528497696, 0.444243103265762, 0.201671078801155},
	 },
	 {
		 {0.035574514418840, 0.355326205492020, 0.532068669795990, 0.365016251802444, -0.073634497821331, -0.465318322181702, -0.530453860759735, -0.275269746780396, 0.053721107542515},
		 {-0.146741926670074, 0.255676150321960, 0.633604526519775, 0.649693191051483, 0.224095433950424, -0.344439208507538, -0.638518810272217, -0.499315738677979, -0.125015646219254},
		 {-0.364618629217148, 0.028112193569541, 0.576707482337952, 0.854068875312805, 0.584915459156036, -0.057319898158312, -0.589534461498261, -0.664040207862854, -0.344700664281845},
		 {-0.541857957839966, -0.271989881992340, 0.341497480869293, 0.876353859901428, 0.883756875991821, 0.327465116977692, -0.360877871513367, -0.688842415809631, -0.529862225055695},
		 {-0.606343388557434, -0.543606758117676, -0.010964774526656, 0.681080460548401, 1.000000000000000, 0.681080460548401, -0.010964774526656, -0.543606758117676, -0.606343388557434},
		 {-0.529862225055695, -0.688842415809631, -0.360877871513367, 0.327465116977692, 0.883756875991821, 0.876353859901428, 0.341497480869293, -0.271989881992340, -0.541857957839966},
		 {-0.344700664281845, -0.664040207862854, -0.589534461498261, -0.057319898158312, 0.584915459156036, 0.854068875312805, 0.576707482337952, 0.028112193569541, -0.364618629217148},
		 {-0.125015646219254, -0.499315738677979, -0.638518810272217, -0.344439208507538, 0.224095433950424, 0.649693191051483, 0.633604526519775, 0.255676150321960, -0.146741926670074},
		 {0.053721107542515, -0.275269746780396, -0.530453860759735, -0.465318322181702, -0.073634497821331, 0.365016251802444, 0.532068669795990, 0.355326205492020, 0.035574514418840},
	 },
	 {
		 {-0.133822575211525, 0.202007442712784, 0.513735890388489, 0.502791404724121, 0.118603765964508, -0.347507655620575, -0.532081127166748, -0.344138950109482, -0.007841077633202},
		 {-0.300441861152649, 0.064512975513935, 0.539023876190186, 0.716854870319366, 0.388290017843246, -0.208480507135391, -0.599083304405212, -0.529829263687134, -0.163342908024788},
		 {-0.466755270957947, -0.151884391903877, 0.439257621765137, 0.846702218055725, 0.682308971881866, 0.046620767563581, -0.544794857501984, -0.665776193141937, -0.348214060068130},
		 {-0.579593241214752, -0.396971791982651, 0.216375634074211, 0.830734908580780, 0.912613630294800, 0.364117711782455, -0.357535630464554, -0.696679651737213, -0.510458648204803},
		 {-0.597214341163635, -0.599186480045319, -0.077338315546513, 0.654632270336151, 1.000000000000000, 0.654632270336151, -0.077338315546513, -0.599186480045319, -0.597214341163635},
		 {-0.510458648204803, -0.696679651737213, -0.357535630464554, 0.364117711782455, 0.912613630294800, 0.830734908580780, 0.216375634074211, -0.396971791982651, -0.579593241214752},
		 {-0.348214060068130, -0.665776193141937, -0.544794857501984, 0.046620767563581, 0.682308971881866, 0.846702218055725, 0.439257621765137, -0.151884391903877, -0.466755270957947},
		 {-0.163342908024788, -0.529829263687134, -0.599083304405212, -0.208480507135391, 0.388290017843246, 0.716854870319366, 0.539023876190186, 0.064512975513935, -0.300441861152649},
		 {-0.007841077633202, -0.344138950109482, -0.532081127166748, -0.347507655620575, 0.118603765964508, 0.502791404724121, 0.513735890388489, 0.202007442712784, -0.133822575211525},
	 },
	 {
		 {-0.269664853811264, 0.016565000638366, 0.417661607265472, 0.578022658824921, 0.305867791175842, -0.190710380673409, -0.496787667274475, -0.406625986099243, -0.085430033504963},
		 {-0.404503345489502, -0.126772120594978, 0.394914954900742, 0.729432582855225, 0.535734713077545, -0.051045965403318, -0.533506095409393, -0.556429028511047, -0.217453643679619},
		 {-0.521539449691772, -0.310519695281982, 0.284542173147202, 0.806997954845428, 0.765357017517090, 0.162153273820877, -0.482535153627396, -0.665509641170502, -0.366995722055435},
		 {-0.587537050247192, -0.496277034282684, 0.096839345991611, 0.776184737682343, 0.936517834663391, 0.409702897071838, -0.339110523462296, -0.698026895523071, -0.499705851078033},
		 {-0.580471038818359, -0.637630105018616, -0.129346802830696, 0.633136689662933, 1.000000000000000, 0.633136689662933, -0.129346802830696, -0.637630105018616, -0.580471038818359},
		 {-0.499705851078033, -0.698026895523071, -0.339110523462296, 0.409702897071838, 0.936517834663391, 0.776184737682343, 0.096839345991611, -0.496277034282684, -0.587537050247192},
		 {-0.366995722055435, -0.665509641170502, -0.482535153627396, 0.162153273820877, 0.765357017517090, 0.806997954845428, 0.284542173147202, -0.310519695281982, -0.521539449691772},
		 {-0.217453643679619, -0.556429028511047, -0.533506095409393, -0.051045965403318, 0.535734713077545, 0.729432582855225, 0.394914954900742, -0.126772120594978, -0.404503345489502},
		 {-0.085430033504963, -0.406625986099243, -0.496787667274475, -0.190710380673409, 0.305867791175842, 0.578022658824921, 0.417661607265472, 0.016565000638366, -0.269664853811264},
	 },
	 {
		 {-0.349130064249039, -0.165476635098457, 0.261557102203369, 0.578382313251495, 0.463724106550217, -0.005881647579372, -0.416056454181671, -0.448715299367905, -0.173307090997696},
		 {-0.452993869781494, -0.295345932245255, 0.219279631972313, 0.685993552207947, 0.653052866458893, 0.120247125625610, -0.436857789754868, -0.569607615470886, -0.282743394374847},
		 {-0.535027146339417, -0.439260363578796, 0.124323062598705, 0.737943708896637, 0.828925311565399, 0.285424113273621, -0.400496900081635, -0.658632159233093, -0.398850113153458},
		 {-0.575596332550049, -0.570878863334656, -0.012652471661568, 0.715322792530060, 0.954410672187805, 0.462965697050095, -0.305329442024231, -0.693216145038605, -0.499654293060303},
		 {-0.563306093215942, -0.662238538265228, -0.166585430502892, 0.617285907268524, 1.000000000000000, 0.617285907268524, -0.166585430502892, -0.662238538265228, -0.563306093215942},
		 {-0.499654293060303, -0.693216145038605, -0.305329442024231, 0.462965697050095, 0.954410672187805, 0.715322792530060, -0.012652471661568, -0.570878863334656, -0.575596332550049},
		 {-0.398850113153458, -0.658632159233093, -0.400496900081635, 0.285424113273621, 0.828925311565399, 0.737943708896637, 0.124323062598705, -0.439260363578796, -0.535027146339417},
		 {-0.282743394374847, -0.569607615470886, -0.436857789754868, 0.120247125625610, 0.653052866458893, 0.685993552207947, 0.219279631972313, -0.295345932245255, -0.452993869781494},
		 {-0.173307090997696, -0.448715299367905, -0.416056454181671, -0.005881647579372, 0.463724106550217, 0.578382313251495, 0.261557102203369, -0.165476635098457, -0.349130064249039},
	 },
	 {
		 {-0.366714835166931, -0.314451247453690, 0.072658643126488, 0.503810644149780, 0.569358050823212, 0.188046649098396, -0.287795662879944, -0.455074042081833, -0.260641425848007},
		 {-0.451420456171036, -0.426215618848801, 0.032085474580526, 0.591451644897461, 0.728699207305908, 0.294029504060745, -0.307431042194366, -0.558669924736023, -0.351508527994156},
		 {-0.517878472805023, -0.535214543342590, -0.030984427779913, 0.644565045833588, 0.868870258331299, 0.411245435476303, -0.297326087951660, -0.639121413230896, -0.439500272274017},
		 {-0.553521275520325, -0.623817622661591, -0.108994804322720, 0.650917410850525, 0.965484499931335, 0.522294104099274, -0.255822181701660, -0.681098878383636, -0.510313451290131},
		 {-0.550933063030243, -0.675783276557922, -0.188929498195648, 0.607576608657837, 1.000000000000000, 0.607576608657837, -0.188929498195648, -0.675783276557922, -0.550933063030243},
		 {-0.510313451290131, -0.681098878383636, -0.255822181701660, 0.522294104099274, 0.965484499931335, 0.650917410850525, -0.108994804322720, -0.623817622661591, -0.553521275520325},
		 {-0.439500272274017, -0.639121413230896, -0.297326087951660, 0.411245435476303, 0.868870258331299, 0.644565045833588, -0.030984427779913, -0.535214543342590, -0.517878472805023},
		 {-0.351508527994156, -0.558669924736023, -0.307431042194366, 0.294029504060745, 0.728699207305908, 0.591451644897461, 0.032085474580526, -0.426215618848801, -0.451420456171036},
		 {-0.260641425848007, -0.455074042081833, -0.287795662879944, 0.188046649098396, 0.569358050823212, 0.503810644149780, 0.072658643126488, -0.314451247453690, -0.366714835166931},
	 }};

float GetDirect(
	Image *image,
	UINT8 widthSquare,
	UINT8 i,
	UINT8 j)
{
	int Ax = 0, Ay = 0, Axy = 0;
	int Bx = 0, By = 0;
	int size = MaxWidth;
	int startX = i - widthSquare;
	int endX = i + widthSquare - 1;
	int startY = j - widthSquare;
	int endY = j + widthSquare - 1;

	for (int x = startX; x < endX; x++)
	{
		for (int y = startY; y < endY; y++)
		{
			UINT8 *SubImage = &(image->data[x][y]);
			// Bx = ((data[i + 2][j] + 2 * data[i + 2][j + 1] + data[i + 2][j + 2] - data[i][j] - 2 * data[i][j + 1] - data[i][j + 2]));
			// By = ((data[i][j + 2] + 2 * data[i + 1][j + 2] + data[i + 2][j + 2] - data[i][j] - 2 * data[i + 1][j] - data[i + 2][j]));

			Bx = ((*(SubImage + size * 2) + 2 * *(SubImage + size * 2 + 1) + *(SubImage + size * 2 + 2) - *SubImage - 2 * *(SubImage + 1) - *(SubImage + 2)));
			By = ((*(SubImage + 2) + 2 * *(SubImage + size + 2) + *(SubImage + size * 2 + 2) - *SubImage - 2 * *(SubImage + size) - *(SubImage + size * 2)));

			Ax += Bx * Bx;
			Ay += By * By;
			Axy += Bx * By;
		}
	}

	float direction = PI / 2 - 0.5 * atan2_approximation2(2 * Axy, Ax - Ay);
	return direction;
}
VOID SetImage(
	Image *image,
	UINT8 widthSquare)
{
	UINT8 i, j, x, y;
	int Ax, Ay, Axy;
	int Bx, By;
	int size = MaxWidth;
	if (image->Height <= 0 || image->Width <= 0)
	{
		printf("Image size error: Too small %d x %d \n", image->Width, image->Height);
		return;
	}

	for (x = widthSquare + 1; x < width - widthSquare - 1; x++)
	{
		for (y = widthSquare + 1; y < height - widthSquare - 1; y++)
		{
			Ax = 0;
			Ay = 0;
			Axy = 0;
			Bx = 0;
			By = 0;

			int startX = x - widthSquare;
			int endX = x + widthSquare - 1;
			int startY = y - widthSquare;
			int endY = y + widthSquare - 1;

			for (i = startX; i < endX; i++)
			{
				for (j = startY; j < endY; j++)
				{

					UINT8 *SubImage = &(image->data[i][j]);
					// Bx = ((data[i + 2][j] + 2 * data[i + 2][j + 1] + data[i + 2][j + 2] - data[i][j] - 2 * data[i][j + 1] - data[i][j + 2]));
					// By = ((data[i][j + 2] + 2 * data[i + 1][j + 2] + data[i + 2][j + 2] - data[i][j] - 2 * data[i + 1][j] - data[i + 2][j]));

					Bx = ((*(SubImage + size * 2) + 2 * *(SubImage + size * 2 + 1) + *(SubImage + size * 2 + 2) - *SubImage - 2 * *(SubImage + 1) - *(SubImage + 2)));
					By = ((*(SubImage + 2) + 2 * *(SubImage + size + 2) + *(SubImage + size * 2 + 2) - *SubImage - 2 * *(SubImage + size) - *(SubImage + size * 2)));

					Ax += Bx * Bx;
					Ay += By * By;
					Axy += Bx * By;
				}
			}

			float direction = PI / 2 - 0.5 * atan2_approximation2(2 * Axy, Ax - Ay);
			image->direct[x][y] = direction;
		}
	}
}

// Normalization helper functions

//----------------------To normal progress----------------------
float GetM(Image *image, int x, int y)
{
	UINT32 temp = 0;
	int count = 0;
	for (int j = x - 10; j < x + 10; j++)
	{
		for (int i = y - 10; i < y + 10; i++)
		{
			temp = temp + image->data[i][j];
			count++;
		}
	}

	return (float)temp / (count);
}

float GetV(Image *image, float GetM_value, int x, int y)
{
	float temp = 0;
	int count = 0;
	for (int j = x - 5; j < x + 5 + 1; j++)
	{
		for (int i = y - 5; i < y + 5 + 1; i++)
		{
			count++;
			temp += (image->data[i][j] - GetM_value) * (image->data[i][j] - GetM_value);
		}
	}

	return (float)temp / (count);
}

float Segmentation(Image *image)
{
	int NumOfBlock = 4;

	float m[NumOfBlock][NumOfBlock];
	float v[NumOfBlock][NumOfBlock];

	float _count = 0;

	for (int i = 0; i < NumOfBlock; i++)
	{
		for (int j = 0; j < NumOfBlock; j++)
		{
			int x = 14 + i * 20;
			int y = 14 + j * 20;

			m[i][j] = GetM(image, x, y);
			v[i][j] = GetV(image, m[i][j], x, y);
			// printf("M[%d][%d]: %f\n\n", i, j, m[i][j]);
			if( m[i][j] > 195 || m[i][j] < 65){
				_count+=1.5;
			}
			else if (m[i][j] > 180 || m[i][j] < 85)
			{
				_count++;
			}
			else if (m[i][j] > 170 || m[i][j] < 105)
			{
				_count+=0.35;
			}
		}
	}
	return (_count > 4.5);

	float G_m = 0;
	float V_m = 0;
	float G_f = 0;
	float V_f = 0;
	int countG_f = 0;
	int countV_f = 0;
	float G_b = 0;
	float V_b = 0;
	int countG_b = 0;
	int countV_b = 0;

	for (int i = 0; i < NumOfBlock; i++)
	{
		for (int j = 0; j < NumOfBlock; j++)
		{
			G_m += m[i][j];
			V_m += v[i][j];
		}
	}

	G_m = G_m / (NumOfBlock * NumOfBlock);
	V_m = V_m / (NumOfBlock * NumOfBlock);

	for (int i = 0; i < NumOfBlock; i++)
	{
		for (int j = 0; j < NumOfBlock; j++)
		{
			if (m[i][j] < G_m)
			{
				G_b += m[i][j];
				countG_b++;
			}
			else if (m[i][j] > G_m)
			{
				G_f += m[i][j];
				countG_f++;
			}

			if (v[i][j] < V_m)
			{
				V_b += v[i][j];
				countV_b++;
			}
			else if (v[i][j] > V_m)
			{
				V_f += v[i][j];
				countV_f++;
			}
		}
	}

	G_b = G_b / countG_b;
	G_f = G_f / countG_f;
	V_b = V_b / countV_b;
	V_f = V_f / countV_f;

	int threshold = 3;
	int count = 0;
	// printf("G_m: %f\nV_m: %f\nG_b: %f\nV_b: %f\n\n",G_m,V_m,G_b,V_b);
	for (int i = 0; i < NumOfBlock; i++)
	{
		for (int j = 0; j < NumOfBlock; j++)
		{
			if ((m[i][j] < G_b || m[i][j] > G_f))
			{
				count++;
				// printf("M[%d][%d]: %f\nV[%d][%d]: %f\n\n",i,j,m[i][j],i,j,v[i][j]);
			}
		}
	}

	return count;

	if (count >= threshold)
	{
		return 1;
	}
	return 0;
}

VOID ToNornal(
	Image *image,
	UINT16 M,
	UINT16 V)
{
	//-------------------------------------------------------

	// float m = GetM(image);
	// float v = GetV(image, m);
	// for(int i=0;i<width;i++)
	// {
	// 	for(int j=0;j<height;j++)
	// 	{
	// 		UINT8 tempData = image->data[i][j];
	// 		if(tempData>m)
	// 		{
	// 			image->data[i][j] = (UINT32)(M + sqrt((tempData-m)*(tempData-m)*V/v));
	// 		}
	// 		else
	// 		{
	// 			image->data[i][j] = (UINT32)(M - sqrt((tempData-m)*(tempData-m)*V/v));
	// 		}
	// 	}
	// }
	//------------------------------------
	Image tempImage;
	tempImage.Height = image->Height;
	tempImage.Width = image->Width;

	for (int i = 1; i < image->Width - 1; i++)
	{
		for (int j = 1; j < image->Height - 1; j++)
		{
			UINT8 neighbors[9];
			int k = 0;

			for (int dx = -1; dx <= 1; dx++)
			{
				for (int dy = -1; dy <= 1; dy++)
				{
					neighbors[k++] = image->data[i + dx][j + dy];
				}
			}

			// Sắp xếp mảng neighbors để lấy giá trị trung vị
			for (int m = 0; m < 9; m++)
			{
				for (int n = m + 1; n < 9; n++)
				{
					if (neighbors[m] > neighbors[n])
					{
						UINT8 temp = neighbors[m];
						neighbors[m] = neighbors[n];
						neighbors[n] = temp;
					}
				}
			}

			tempImage.data[i][j] = neighbors[4]; // Giá trị trung vị
		}
	}

	// Sao chép kết quả vào trường dữ liệu gốc
	for (int i = 1; i < image->Width - 1; i++)
	{
		for (int j = 1; j < image->Height - 1; j++)
		{
			image->data[i][j] = tempImage.data[i][j];
		}
	}
}
//---------------------------------------------------------------
VOID Mask_Gabor(MaskFilter *Mask, UINT8 widthSquare, float filterDirect, float f, UINT8 fi)
{
	float sinn = sin(filterDirect);
	float coss = cos(filterDirect);
	for (int x = 0; x < 2 * widthSquare + 1; x++)
	{
		for (int y = 0; y < 2 * widthSquare + 1; y++)
		{
			float x1 = sinn * (x - widthSquare) + coss * (y - widthSquare);
			float y1 = sinn * (y - widthSquare) - coss * (x - widthSquare);
			Mask->mask[x][y] = exp(-0.5 * (pow(x1, 2) / pow(fi, 2) + pow(y1, 2) / pow(fi, 2))) * cos(2 * PI * f * x1);
		}
		// Mask->width = widthSquare*2 + 1;
	}
}

VOID CalMaskFilter(MaskFilter *Mask)
{

	for (int i = 0; i < MaskNumber; i++)
	{
		Mask_Gabor(&Mask[i], WidthSquare, i * PI / MaskNumber, 1.0 / f_para2, fi_para);
	}
}

VOID ToFiltring_Gabor(Image *image, UINT16 widthSquare)
{
	float pointValue = 0;
	// GetClock("before GetMaskFilter");
	//  MaskFilter Mask[MaskNumber];
	//  CalMaskFilter(Mask);
	for (int x = widthSquare + 1; x < width - widthSquare - 1; x++)
	{
		for (int y = widthSquare + 1; y < height - widthSquare - 1; y++)
		{
			UINT8 index = (UINT8)(image->direct[x][y] / (PI / MaskNumber));
			index = (index > (MaskNumber - 1)) ? (MaskNumber - 1) : index;

			for (int i = -widthSquare; i < widthSquare + 1; i++)
			{
				for (int j = -widthSquare; j < widthSquare + 1; j++)
				{
					//  pointValue += Mask[index].mask[i+widthSquare][j+widthSquare] * image->data[i+x][j+y];
					pointValue += mask_gabor[index][i + widthSquare][j + widthSquare] * image->data[i + x][j + y];
				}
			}
			if (pointValue < 0)
				pointValue = 0;
			if (pointValue > 255)
				pointValue = 255;
			image->data[x][y] = (UINT8)(pointValue);
		}
	}
}
//-----------------------To binary progress----------------------

VOID MaskGaussin(MaskFilter *Mask, UINT8 widthSquare, float sigma)
{
	float twoSigmaSquared = 2 * sigma * sigma;
	float sum = 0.0;

	for (int x = 0; x < 2 * widthSquare + 1; x++)
	{
		for (int y = 0; y < 2 * widthSquare + 1; y++)
		{
			float distanceSquared = (x - widthSquare) * (x - widthSquare) + (y - widthSquare) * (y - widthSquare);
			Mask->mask[x][y] = -(1 - distanceSquared / twoSigmaSquared) * exp(-distanceSquared / twoSigmaSquared);
			sum += (Mask->mask[x][y]);
		}
	}

	// Normalize the mask
	for (int x = 0; x < 2 * widthSquare + 1; x++)
	{
		for (int y = 0; y < 2 * widthSquare + 1; y++)
		{
			Mask->mask[x][y] /= sum;
		}
	}
}

VOID ToFiltring_Gaussin(Image *image, UINT16 widthSquare)
{
	float pointValue = 0;
	MaskFilter Mask;
	MaskGaussin(&Mask, WidthSquare, 1.0 / f_para);
	for (int x = widthSquare + 1; x < width - widthSquare - 1; x++)
	{
		for (int y = widthSquare + 1; y < height - widthSquare - 1; y++)

		{
			for (int i = -widthSquare; i < widthSquare + 1; i++)
			{
				for (int j = -widthSquare; j < widthSquare + 1; j++)
				{
					pointValue += Mask.mask[i + widthSquare][j + widthSquare] * image->data[i + x][j + y];
				}
			}

			if (pointValue < 0)
				pointValue = 0;
			if (pointValue > 255)
				pointValue = 255;

			image->data[x][y] = (UINT8)(pointValue);
		}
	}
}

//---------------------------------------------------------------

//-----------------------To binary progress----------------------

float GetF(Image *image, int g)
{
	int GetT_g = 0;
	int temp_g = 0;
	int temp_255 = 0;
	int x, y;
	for (x = 0; x < width; x++)
	{
		for (y = 0; y < height; y++)
		{
			if (image->data[x][y] <= g)
			{
				GetT_g++;
				temp_g += image->data[x][y];
			}
			if (image->data[x][y] <= 255)
			{
				temp_255 += image->data[x][y];
			}
		}
	}
	float GetMbinary_g = temp_g / GetT_g;
	float GetMbinary_255 = temp_255 / GetT_g;
	return (float)(GetT_g * (GetMbinary_g - GetMbinary_255) * (GetMbinary_g - GetMbinary_255)) / (float)((width * height) - GetT_g);
}

UINT16 GetThreshold(Image *image)
{
	int threshold = 0;
	float tempF = 0;
	for (int g = 125; g <= 255; g++)
	{
		float F = GetF(image, g);
		if (F > tempF)
		{
			tempF = F;
			threshold = g;
		}
	}
	return threshold;
}

VOID ToBinary(
	Image *image,
	UINT16 thresh,
	UINT16 widthSquare)
{
	UINT16 thresthold;
	if (thresh > 0 && thresh < 255)
		thresthold = thresh;
	else
	{
		thresthold = GetThreshold(image) - 10;
	}
	// printf("%d ----------- \n",thresthold);
	for (int j = widthSquare + 1; j < height - (widthSquare + 1); j++)
	{
		for (int i = widthSquare + 1; i < width - (widthSquare + 1); i++)
		{
			if (image->data[i][j] >= thresthold)
				image->data[i][j] = 255;
			else
				image->data[i][j] = 0;
		}
	}
}

//---------------------------------------------------------------
//-----------------------To RidgeThin progress----------------------

BOOLEAN IsBoder(Image *image, int x, int y, UINT8 isDeleable[][MaxHeight])
{
	int p1 = image->data[x - 1][y - 1];
	int p2 = image->data[x    ][y - 1];
	int p3 = image->data[x + 1][y - 1];
	int p4 = image->data[x - 1][y    ];
	int p5 = image->data[x + 1][y    ];
	int p6 = image->data[x - 1][y + 1];
	int p7 = image->data[x    ][y + 1];
	int p8 = image->data[x + 1][y + 1];

	int _p2 = (isDeleable[x][y - 1]) ? 0 : p2;
	int _p4 = (isDeleable[x - 1][y]) ? 0 : p4;
	int _p5 = (isDeleable[x + 1][y]) ? 0 : p5;
	int _p7 = (isDeleable[x][y + 1]) ? 0 : p7;

	int p = p1 + p2 + p3 + p4 + p5 + p6 + p7 + p8;

	if ((p >= 255 * 3 && p <= 255 * 6) && (image->data[x][y] == 0) &&
		((_p5 == 255 || _p7 == 255 || _p4 == 255) && (_p7 == 255 || _p4 == 255 || _p2 == 255)))
		// ||(image->data[x+1][y]==255||image->data[x][y+1]==255||image->data[x][y-1]==255)
		// &&(image->data[x+1][y]==255||image->data[x-1][y]==255||image->data[x][y-1]==255)
		return true;
	return false;
}
BOOLEAN IsDeleable(Image *image, int x, int y, UINT8 isDeleable[][MaxHeight])
{
	// if((image->data[x-1][y]==255||image->data[x+1][y]==255||image->data[x][y-1]==255||image->data[x][y+1]==255)&&image->data[x][y]==0){
	int p1 = (isDeleable[x - 1][y - 1]) ? 0 : image->data[x - 1][y - 1];
	int p2 = (isDeleable[x    ][y - 1]) ? 0 : image->data[x    ][y - 1];
	int p3 = (isDeleable[x + 1][y - 1]) ? 0 : image->data[x + 1][y - 1];
	int p4 = (isDeleable[x - 1][y    ]) ? 0 : image->data[x - 1][y    ];
	int p5 = (isDeleable[x + 1][y    ]) ? 0 : image->data[x + 1][y    ];
	int p6 = (isDeleable[x - 1][y + 1]) ? 0 : image->data[x - 1][y + 1];
	int p7 = (isDeleable[x    ][y + 1]) ? 0 : image->data[x    ][y + 1];
	int p8 = (isDeleable[x + 1][y + 1]) ? 0 : image->data[x + 1][y + 1];

	if ((p1 + p2 + p3) == 0 && (p6 * p7 * p8) > 0)
		return true;
	if ((p1 + p2 + p4) == 0 && (p5 * p7 * p8) > 0)
		return true;
	if ((p1 + p4 + p6) == 0 && (p3 * p5 * p8) > 0)
		return true;
	if ((p3 + p2 + p5) == 0 && (p4 * p7 * p6) > 0)
		return true;
	if ((p6 + p7 + p8) == 0 && (p1 * p2 * p3) > 0)
		return true;
	if ((p8 + p5 + p7) == 0 && (p2 * p4 * p1) > 0)
		return true;
	if ((p3 + p5 + p8) == 0 && (p1 * p4 * p6) > 0)
		return true;
	if ((p6 + p4 + p7) == 0 && (p2 * p5 * p3) > 0)
		return true;

	return false;
	// }
}
VOID MakeBone(Image *image)
{
	BOOLEAN isBone = false;
	while (!isBone)
	// for(int count = 0; count < 20; count++)
	{
		UINT8 temp[MaxHeight][MaxWidth];
		ZeroMem(temp, sizeof(temp));
		isBone = true;
		for (int j = 1; j < height - 1; j++)
		{
			for (int i = 1; i < width - 1; i++)
			{
				if (IsBoder(image, i, j, temp))
				{
					if (IsDeleable(image, i, j, temp))
					{
						temp[i][j] = 1;
						image->data[i][j] = 255;
						isBone = false;
					}
				}
			}
		}
	}
}

// BOOLEAN IsBoder(Image *image, int x, int y, UINT8 isDeleable[][MaxHeight])
// {
// 	int p1 = (isDeleable[x-1][y-1]) ? 255 : image->data[x-1][y-1];
// 	int p2 = (isDeleable[x  ][y-1]) ? 255 : image->data[x  ][y-1];
// 	int p3 = (isDeleable[x+1][y-1]) ? 255 : image->data[x+1][y-1];
// 	int p4 = (isDeleable[x-1][y  ]) ? 255 : image->data[x-1][y  ];
// 	int p5 = (isDeleable[x+1][y  ]) ? 255 : image->data[x+1][y  ];
// 	int p6 = (isDeleable[x-1][y+1]) ? 255 : image->data[x-1][y+1];
// 	int p7 = (isDeleable[x  ][y+1]) ? 255 : image->data[x  ][y+1];
// 	int p8 = (isDeleable[x+1][y+1]) ? 255 : image->data[x+1][y+1];

// 	int p = p1 + p2 + p3 + p4 + p5 + p6 + p7 + p8;

// 	if((p>= 255*3 && p<=255*6)&&(image->data[x][y]==0)&&
// 		((image->data[x+1][y]==255||image->data[x][y+1]==255||image->data[x-1][y]==255)
// 		&&(image->data[x][y+1]==255||image->data[x-1][y]==255||image->data[x][y-1]==255))
// 		)
// 		// ||(image->data[x+1][y]==255||image->data[x][y+1]==255||image->data[x][y-1]==255)
// 		// &&(image->data[x+1][y]==255||image->data[x-1][y]==255||image->data[x][y-1]==255)
// 		return true;
// 	return false;
// }
// BOOLEAN IsDeleable(Image *image, int x,int y)
// {
// 	// if((image->data[x-1][y]==255||image->data[x+1][y]==255||image->data[x][y-1]==255||image->data[x][y+1]==255)&&image->data[x][y]==0){
// 	int p1 = image->data[x-1][y-1];
// 	int p2 = image->data[x  ][y-1];
// 	int p3 = image->data[x+1][y-1];
// 	int p4 = image->data[x-1][y  ];
// 	int p5 = image->data[x+1][y  ];
// 	int p6 = image->data[x-1][y+1];
// 	int p7 = image->data[x  ][y+1];
// 	int p8 = image->data[x+1][y+1];

// 		if((p1+p2+p3)==0&&(p6*p7*p8)>0) return true;
// 	if((p1+p2+p4)==0&&(p5*p7*p8)>0) return true;
// 		if((p1+p4+p6)==0&&(p3*p5*p8)>0) return true;
// 	if((p3+p2+p5)==0&&(p4*p7*p6)>0) return true;
// 		if((p6+p7+p8)==0&&(p1*p2*p3)>0) return true;
// 	if((p8+p5+p7)==0&&(p2*p4*p1)>0) return true;
// 		if((p3+p5+p8)==0&&(p1*p4*p6)>0) return true;
// 	if((p6+p4+p7)==0&&(p2*p5*p3)>0) return true;

// 	return false;
// 	// }
// }
// VOID MakeBone(Image *image)
// {
// 	BOOLEAN isBone = false;
// 	while(!isBone)
// 	// for(int count = 0; count < 20; count++)
// 	{
// 	UINT8 temp[MaxHeight][MaxWidth];
// 	ZeroMem(temp,sizeof(temp));
// 		isBone = true;
// 		for(int j=1;j<height-1;j++)
// 		{
// 			for(int i=1;i<width-1;i++)
// 			{
// 				if(IsBoder(image, i, j, temp))
// 				{
// 					if(IsDeleable(image, i, j))
// 					{
// 						temp[i][j]=1;
// 						isBone = false;
// 					}
// 				}
// 			}
// 		}

// 		for(int j=1;j<height-1;j++)
// 		{
// 			for(int i=1;i<width-1;i++)
// 			{
// 				if(temp[i][j])
// 				{
// 					image->data[i][j] = 255;
// 				}
// 			}
// 		}
// 	}

// }
VOID ClearBone(Image *image)
{
	for (int y = 1; y < height - 1; y++)
	{
		for (int x = 1; x < width - 1; x++)
		{
			if (image->data[x][y] == 0)
			{
				int p1 = image->data[x - 1][y - 1];
				int p2 = image->data[x][y - 1];
				int p3 = image->data[x + 1][y - 1];
				int p4 = image->data[x - 1][y];
				int p5 = image->data[x + 1][y];
				int p6 = image->data[x - 1][y + 1];
				int p7 = image->data[x][y + 1];
				int p8 = image->data[x + 1][y + 1];

				if ((p2 + p4) == 0 && (p5 * p7 * p8) > 0)
				{
					image->data[x][y] = 255;
				}
				if ((p2 + p5) == 0 && (p4 * p7 * p6) > 0)
				{
					image->data[x][y] = 255;
				}
				if ((p5 + p7) == 0 && (p2 * p4 * p1) > 0)
				{
					image->data[x][y] = 255;
				}
				if ((p4 + p7) == 0 && (p2 * p5 * p3) > 0)
				{
					image->data[x][y] = 255;
				}
				if (((p2 + p5 + p7) == 0) || ((p5 + p7 + p4) == 0) || ((p7 + p4 + p2) == 0) || ((p4 + p2 + p5) == 0))
				{
					image->data[x][y] = 255;
				}
			}
		}
	}
}

VOID ToBoneImage(Image *image)
{
	MakeBone(image);
	ClearBone(image);
}

//---------------------------------------------------------------

//-----------------------Minutiae finding progress----------------------
//-----------------------Minutiae finding progress----------------------
INT8 IsFeature(Image *image, int x, int y)
{
	if (x > 0 && x < width && y > 0 && y < height && image->data[x][y] == 0)
	{
		int result = image->data[x - 1][y - 1] + image->data[x - 1][y] + image->data[x - 1][y + 1] + image->data[x][y + 1] + image->data[x + 1][y + 1] + image->data[x + 1][y] + image->data[x + 1][y - 1] + image->data[x][y - 1];
		if (result == 7 * 255)
		{
			return 1;
		}
		if (result == 5 * 255)
		{
			return 2;
		}
		return 0;
	}
	return 0;
}

VOID GetMinutiae(
	SpecialPoint *minus,
	Image *image,
	UINT8 leftPading,
	UINT8 topPadding,
	UINT8 rightPadding,
	UINT8 bottomPadding)
{
	int cnt = 0;
	for (int x = leftPading; x < width - rightPadding; x++)
	{
		for (int y = topPadding; y < height - bottomPadding; y++)
		{
			int temp = IsFeature(image, x, y);
			if (temp)
			{
				minus->minus[cnt].direct = image->direct[x][y];
				minus->minus[cnt].x = x;
				minus->minus[cnt].y = y;
				minus->minus[cnt].Type = temp;
				cnt++;
			}
		}
	}
	minus->Count = cnt;

	for (int i = 0; i < minus->Count - 1; i++)
	{
		for (int j = i + 1; j < minus->Count; j++)
		{
			UINT32 Distance = (UINT32)(sqrt(pow(minus->minus[i].x - minus->minus[j].x, 2) + pow(minus->minus[i].y - minus->minus[j].y, 2)));
			if (Distance <= 3)
			{
				// minus1.RemoveAt(j);
				for (int b = j; b < minus->Count; b++) // dich chuyen mang
				{
					minus->minus[b] = minus->minus[b + 1];
				}
				minus->Count--;
				// minus1.RemoveAt(i);
				for (int a = i; a < minus->Count; a++) // dich chuyen mang
				{
					minus->minus[a] = minus->minus[a + 1];
				}
				minus->Count--;
				if (i > 0)
				{

					j = j - 2;
					i--;
					break;
				}
				else
				{
					if (j > 1)
						j--;
					break;
				}
			}
			else if ((Distance > 3 && Distance < 6 && minus->minus[i].Type == minus->minus[j].Type && minus->minus[j].Type == 1))
			{
				// minus1.RemoveAt(j);
				for (int b = j; b < minus->Count; b++) // dich chuyen mang
				{
					minus->minus[b] = minus->minus[b + 1];
				}
				minus->Count--;
				// minus1.RemoveAt(i);
				for (int a = i; a < minus->Count; a++) // dich chuyen mang
				{
					minus->minus[a] = minus->minus[a + 1];
				}
				minus->Count--;
				if (i > 0)
				{

					j = j - 2;
					i--;
					break;
				}
				else
				{
					if (j > 1)
						j--;
					break;
				}
			}
			else if ((Distance > 3 && Distance < 6 && minus->minus[i].Type != minus->minus[j].Type) || (Distance > 3 && Distance < 6 && minus->minus[i].Type == minus->minus[j].Type))
			{

				// minus1.RemoveAt(j);
				for (int b = j; b < minus->Count; b++) // dich chuyen mang
				{
					minus->minus[b] = minus->minus[b + 1];
				}
				minus->Count--;
				// minus1.RemoveAt(i);
				//  for(int a = i; a < minus->Count ; a++)//dich chuyen mang
				//  {
				//  	minus->minus[a] = minus->minus[a+1];
				//  }
				//  minus->Count--;
				if (i > 0)
				{

					j = j - 2;
					i--;
					break;
				}
				else
				{
					if (j > 1)
						j--;
					break;
				}
			}
		}
	}
}
//---------------------------------------------------------------
UINT64 factorial(UINT64 num)
{
	if (num == 0)
		return 1;
	else
		return num * factorial(num - 1);
}

GroupDataSpecialPoint *GetTriangle(SpecialPoint *ListSpecialPoint, UINT16 *NumTriangle)
{
	if (ListSpecialPoint->Count < 3 || ListSpecialPoint->Count > 15)
	{
		// printf("Num of minutiae less than 3 or more than 15");
		return NULL;
	}
	UINT16 CountSpecialPoint = ListSpecialPoint->Count;
	UINT16 NumElement = factorial(CountSpecialPoint) / (6 * factorial(CountSpecialPoint - 3));
	GroupDataSpecialPoint *ListTriangle = (GroupDataSpecialPoint *)malloc(NumElement * sizeof(GroupDataSpecialPoint));
	UINT16 counter = 0;
	INT8 dx1;
	INT8 dy1;
	INT8 dx2;
	INT8 dy2;
	INT8 dx3;
	INT8 dy3;

	for (UINT8 i = 0; i < CountSpecialPoint - 2; i++)
	{

		for (UINT8 j = i + 1; j < CountSpecialPoint - 1; j++)
		{

			for (UINT8 k = j + 1; k < CountSpecialPoint; k++)
			{
				dx1 = ListSpecialPoint->minus[i].x - ListSpecialPoint->minus[j].x;
				dy1 = ListSpecialPoint->minus[i].y - ListSpecialPoint->minus[j].y;

				dx2 = ListSpecialPoint->minus[j].x - ListSpecialPoint->minus[k].x;
				dy2 = ListSpecialPoint->minus[j].y - ListSpecialPoint->minus[k].y;

				dx3 = ListSpecialPoint->minus[k].x - ListSpecialPoint->minus[i].x;
				dy3 = ListSpecialPoint->minus[k].y - ListSpecialPoint->minus[i].y;

				ListTriangle[counter].bord1 = sqrt(dx1 * dx1 + dy1 * dy1);
				ListTriangle[counter].bord2 = sqrt(dx2 * dx2 + dy2 * dy2);
				ListTriangle[counter].bord3 = sqrt(dx3 * dx3 + dy3 * dy3);

				ListTriangle[counter].status = 0;
				ListTriangle[counter].id = 0;
				ListTriangle[counter].id = ListTriangle[counter].id | i;
				ListTriangle[counter].id = (ListTriangle[counter].id << 8) | j;
				ListTriangle[counter].id = (ListTriangle[counter].id << 8) | k;
				counter += 1;
			}
		}
	}
	*NumTriangle = NumElement;
	return ListTriangle;
}
VOID ToFiltring(Image *image, UINT16 widthSquare)
{
	float pointValue = 0;
	// GetClock("before GetMaskFilter");
	MaskFilter Mask1[MaskNumber];
	CalMaskFilter(Mask1);
	MaskFilter Mask2;
	MaskGaussin(&Mask2, WidthSquare, 1.0 / f_para);
	for (int x = widthSquare + 1; x < width - widthSquare - 1; x++)
	{
		for (int y = widthSquare + 1; y < height - widthSquare - 1; y++)
		{
			UINT8 index = (UINT8)(image->direct[x][y] / (PI / MaskNumber));
			index = (index > (MaskNumber - 1)) ? (MaskNumber - 1) : index;

			for (int i = -widthSquare; i < widthSquare + 1; i++)
			{
				for (int j = -widthSquare; j < widthSquare + 1; j++)
				{
					pointValue += Mask1[index].mask[i + widthSquare][j + widthSquare] * image->data[i + x][j + y] + Mask2.mask[i + widthSquare][j + widthSquare] * image->data[i + x][j + y];
				}
			}
			if (pointValue < 0)
				pointValue = 0;
			if (pointValue > 255)
				pointValue = 255;
			image->data[x][y] = (UINT8)(pointValue);
		}
	}
}